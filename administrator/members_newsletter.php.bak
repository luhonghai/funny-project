<?php
/**************************************************************************************************
| 9Gag Clone Script
| http://www.best9gagclonescript.com
| support@best9gagclonescript.com
|
|**************************************************************************************************
|
| By using this software you agree that you have read and acknowledged our End-User License 
| 
|
| Copyright (c) best9gagclonescript.com. All rights reserved.
|**************************************************************************************************/

include("../include/config.php");
include_once("../include/functions/import.php");
verify_login_admin();
$page = $_REQUEST['pagenumber'];
$adminurl = $config['adminurl'];
if($_SESSION['value'] == "")
{
$_SESSION['title']=$_POST['title'];
$_SESSION['value']=$_POST['value'];
}
if($page=="")
{
	$page = "1";
}
$currentpage = $page;

if ($page >=2)
{
	$pagingstart = ($page-1)*$config['items_per_page'];
}
else
{
	$pagingstart = "0";
}

if($_POST['submitform1'] == "1" || $page > 1)
{
$query = "SELECT username, email from members order by USERID desc limit $pagingstart, $config[items_per_page]";

$members = mysql_query($query) or die(mysql_error());  

$i=0;
while ($member = mysql_fetch_array($members)){  
				// Send E-Mail Begin
				$sendto = $member['email'];
				$sendername = $config['site_name'];
				$from = $config['site_email'];
				$subject = $_POST['title'];
				$sendmailbody = $_POST['value'] ;
				mailme($sendto,$sendername,$from,$subject,$sendmailbody,$bcc="");
				// Send E-Mail End
$i=$i+1;

}
$pagenumber=$page;
$pagenumber=$pagenumber+1;
if($i!=25){
header("Location:$adminurl/members_newsletter.php?pagenumber=$pagenumber");exit;
}
else
{
$message = "News letter has been sent successfully.";
Stemplate::assign('message',$message);
$_SESSION['value'] = "";
$_SESSION['title'] = "";
}
}


$mainmenu = "7";
$submenu = "2";
Stemplate::assign('mainmenu',$mainmenu);
Stemplate::assign('submenu',$submenu);
STemplate::display("administrator/global_header.tpl");
STemplate::display("administrator/members_newsletter.tpl");
STemplate::display("administrator/global_footer.tpl");
?>